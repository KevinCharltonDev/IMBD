<!DOCTYPE html><html><head><style type='text/css'>div {margin-left: 50px;} body {margin-right: 50px;}</style></head><body><div>This is the documentation for the PHP service used to select, insert, update, and delete data from the database.  An HTTP post request is sent to the file service.php and the results are returned in JSON format.  The following actions can be performed from the iOS app.  Included are the post parameters and the format of the result (see www.json.org).<br/><hr/>1. Search for Businesses<br/>This retrieves simple business data used to display search results.<br/><div><br/>	HTTP POST Parameters<br/><div>		query=search<br/>		search= (what to search for in business name or description)<br/>		location= (what to search for in business location)<br/>		page= (page number)<br/>		rpp= (results per page)<br/></div><br/>	Returned JSON Format If Successful<br/><div>		An array of businesses with between 0 and rpp results<br/>		Each business is an object with the following name/value pairs<br/><div>			Sp_Id: number (ID of the business)<br/>			Name: string (name of the business)<br/>			Type: number (0-3 for Individual, Group, Business, Organization)<br/>			Description: string (description of the business)<br/></div></div><br/>	Example<br/><div>		query=search&search=guitar&location=&page=1&rpp=5<br/><br/>		[{"Sp_Id":13,"Name":"Guitar Center","Type":2,"Description":""},{"Sp_Id":1,"Name":"Guitar Town","Type":2,"Description":"Buys and sells guitars and equipment"},{"Sp_Id":7,"Name":"Tim Mize","Type":0,"Description":"Guitar and Lead Vocals"},{"Sp_Id":2,"Name":"TJ Guitar Repair","Type":2,"Description":"Repairs equipment and guitars"}]<br/></div><br/>	Error Results<br/><div>		None<br/></div></div><br/>2. Look up a Business<br/>This retrieves detailed information for a specific business.<br/><div><br/>	HTTP POST Parameters<br/><div>		query=look_up<br/>		id= (ID of business)<br/></div><br/>	Returned JSON Format If Successful<br/><div>		An object with the following name/value pairs<br/><div>			Data: object<br/><div>				Sp_Id: number (ID of the business)<br/>				Name: string (name of the business)<br/>				Type: number (0-3 for Individual, Group, Business, Organization)<br/>				Description: string (description of the business)<br/></div>			Websites: array of strings<br/>			Contacts: array of objects with the following name/value pairs<br/><div>				C_Id: number (contact ID)<br/>				First: string<br/>				Last: string<br/>				Email: string<br/>				Job: string<br/>				Phone: string<br/>				Extension: string<br/></div>			Locations: array of objects with the following name/value pairs<br/><div>				L_Id: number (location ID)<br/>				Address1: string<br/>				Address2: string<br/>				City: string<br/>				State: string<br/>				Zip: string<br/>				Contacts: array of objects with the following name/value pairs<br/><div>					C_Id: number (contact ID)<br/>					Name: string (full name of contact)<br/></div></div>			Reviews: array of objects with the following name/value pairs<br/><div>				Comment: string<br/>				Rating: number (1-5)<br/>				Date: string (in proper format)<br/>				Name: string (screen name of reviewer)<br/></div>			Services: object treated as an array (loop through all name/value pairs)<br/><div>				'Name of service 1': object with the following name/value pairs<br/><div>					Sp_Id: number (ID of the business)<br/>					'Name of column 1': true/false, number, or string<br/>					'Name of column 2': true/false, number, or string<br/>					...<br/></div>				'Name of service 2' : object with the following name/value pairs<br/><div>					Sp_Id: number (ID of the business)<br/>					'Name of column 1': true/false, number, or string<br/>					'Name of column 2': true/false, number, or string<br/>					...<br/></div>				...<br/></div></div></div><br/>	Example<br/><div>		query=look_up&id=13<br/><br/>		{"Data":{"Sp_Id":13,"Name":"Guitar Center","Type":2,"Description":"","Websites":["stores.guitarcenter.com"]},"Contacts":[{"C_Id":10,"First":"Toby","Last":"K","Email":"","Job":"General Manager","Phone":"15742470131","Extension":"2"},{"C_Id":78,"First":"Jason","Last":"Toomey","Email":"jrtoomey@bsu.edu","Job":"Student","Phone":"1234567890","Extension":"12"}],"Locations":[{"L_Id":4,"Address1":"5825 Grape Road","Address2":"Building 2","City":"Mishawaka","State":"IN","Zip":"46545","Contacts":[{"C_Id":10,"Name":"Toby K"}]},{"L_Id":5,"Address1":"5825 Main Street","Address2":"Apartment 1","City":"Mishawaka","State":"IN","Zip":"46545","Contacts":[{"C_Id":78,"Name":"Jason Toomey"}]}],"Reviews":[{"Comment":"They sold me a guitar.","Rating":5,"Date":"Mar 31, 2015","Name":"Jason Toomey"},{"Comment":"They sold me a guitar.","Rating":4,"Date":"Mar 28, 2015","Name":"Donald James"}],"Services":{"Education":{"Sp_Id":13,"Instructor":"John Smith","Instruments Taught":"Guitar,Drums","Music Types":"Popular","Specialty":"Guitar Lessons","Teaching Background":"I have taught students how to play the guitar for over twenty years.","Teaching Location":"Group,Private,Travels"},"Music Products":{"Sp_Id":13,"Products":"Accessories,Acoustic,Amplifiers,Apparel,Drums,Guitars,Instrument,Lessons,Repair","Specialty":"Guitar"}}}<br/></div><br/>	Error Results<br/><div>		{"Error":true,"Code":3,"Message":"No business was found for this ID"}<br/></div></div><hr/>3. Verify User's Account Information<br/>This checks if an email and password match and returns the user's credentials and account information.<br/><div><br/>	HTTP POST Parameters<br/><div>		query=verify_account<br/>		email= (user's email)<br/>		password= (user's password in plain text *security issue that can't be solved without HTTPS*)<br/></div><br/>	Returned JSON Format If Successful<br/><div>		Object with the following name/value pairs<br/><div>			Verified: true/false (true if account has been verified)<br/>			Email: string (empty if account is not verified)<br/>			ScreenName: string (empty if account is not verified)<br/>			LoginAttempts: number (0 if not verified)<br/>			Type: number (-1 if not verified or 0-2 for Normal, Student, Moderator)<br/>			Suspended: true/false (false if not verified)<br/></div></div><br/>	Example<br/><div>		query=verify_account&email=djames%40gmail.com&password=password<br/><br/>		{"Verified":true,"Email":"djames@gmail.com","ScreenName":"Donald James","LoginAttempts":1000000,"Type":0,"Suspended":false}<br/></div><br/>	Error Results<br/><div>		None<br/></div></div><hr/>4. Update Permissions<br/>This retrieves the businesses the user is allowed to update.<br/><div><br/>	HTTP POST Parameters<br/><div>		query=update_permissions<br/>		email= (user's email)<br/>		password= (user's password)<br/></div><br/>	Returned JSON Format If Successful<br/><div>		Array of objects with the following name/value pairs<br/><div>			Sp_Id: number (ID of the business)<br/>			Name: string (name of the business)<br/>			Type: number (0-3 for Individual, Group, Business, Organization)<br/>			Description: string (description of the business)<br/></div></div><br/>	Example<br/><div>		query=update_permissions&email=djames%40gmail.com&password=password<br/><br/>		[{"Sp_Id":1,"Name":"Guitar Town","Type":2,"Description":"Buys and sells guitars and equipment"},{"Sp_Id":17,"Name":"Lyon's Music Products","Type":2,"Description":"Musical Instrument Store"},{"Sp_Id":2,"Name":"TJ Guitar Repair","Type":2,"Description":"Repairs equipment and guitars"}]<br/></div><br/>	Error Results<br/><div>		None<br/></div></div><hr/>5. Add a Business<br/>This is used to add a new business.<br/><div><br/>	HTTP POST Parameters<br/><div>		query=add<br/>		name= (business name)<br/>		type= (0-3 for Individual, Group, Business, Organization)<br/>		description= (business description)<br/>		websites= (all websites separated by semicolons)<br/>		email= (user's email)<br/>		password= (user's password)<br/></div><br/>	Returned JSON Format If Successful<br/><div>		{"Success":true,"Code":2,"Message":"A new business has been added.","Id":24}<br/></div><br/>	Error Results<br/><div>		{"Error":true,"Code":8,"Message":"The business name must be between 3 and 60 characters."}<br/>		{"Error":true,"Code":8,"Message":"Invalid business type"}<br/>		{"Error":true,"Code":5,"Message":"A business with that name is already in the directory."}<br/></div></div><hr/>6. Update a Business<br/>This is used to update an existing business.<br/><div><br/>	HTTP POST Parameters<br/><div>		query=update<br/>		id= (ID of business)<br/>		name= (business name)<br/>		type= (0-3 for Individual, Group, Business, Organization)<br/>		description= (business description)<br/>		websites= (all websites separated by semicolons)<br/>		email= (user's email)<br/>		password= (user's password)<br/></div><br/>	Returned JSON Format If Successful<br/><div>		{"Success":true,"Code":1,"Message":"The business information has been updated."}<br/></div><br/>	Error Results<br/><div>		{"Error":true,"Code":8,"Message":"The business name must be between 3 and 60 characters."}<br/>		{"Error":true,"Code":8,"Message":"Invalid business type"}<br/>		{"Error":true,"Code":5,"Message":"A business with that name is already in the directory."}<br/></div></div><hr/>7. Add a Location<br/>This is used to add a location to an existing business.<br/><div><br/>	HTTP POST Parameters<br/><div>		query=add_location<br/>		id= (ID of business)<br/>		address1= (address line 1)<br/>		address2= (address line 2)<br/>		city= (city)<br/>		state= (state)<br/>		zip= (zip)<br/>		email= (user's email)<br/>		password= (user's password)<br/></div><br/>	Returned JSON Format If Successful<br/><div>		{"Success":true,"Code":2,"Message":"A new location has been added.","Id":23}<br/></div><br/>	Error Results<br/><div>		{"Error":true,"Code":8,"Message":"Address 1 is required"}<br/>		{"Error":true,"Code":5,"Message":"The location you entered already exists for this business."}<br/></div></div><hr/>8. Update a Location<br/>This is used to update an existing location<br/><div><br/>	HTTP POST Parameters<br/><div>		query=update_location<br/>		lid= (ID of location)<br/>		address1= (address line 1)<br/>		address2= (address line 2)<br/>		city= (city)<br/>		state= (state)<br/>		zip= (zip)<br/>		email= (user's email)<br/>		password= (user's password)<br/></div><br/>	Returned JSON Format If Successful<br/><div>		{"Success":true,"Code":1,"Message":"The location information has been updated."}<br/></div><br/>	Error Results<br/><div>		{"Error":true,"Code":8,"Message":"Address 1 is required"}<br/>		{"Error":true,"Code":5,"Message":"The location you entered already exists for this business."}<br/></div></div><hr/>9. Add a Contact<br/>This is used to add a contact to an existing business.<br/><div><br/>	HTTP POST Parameters<br/><div>		query=add_contact<br/>		id= (ID of business)<br/>		first= (first name)<br/>		last= (last name)<br/>		contactemail= (email for contact)<br/>		job= (job title)<br/>		phone= (phone number with only digits)<br/>		extension= (extension with only digits)<br/>		email= (user's email)<br/>		password= (user's password)<br/></div><br/>	Returned JSON Format If Successful<br/><div>		{"Success":true,"Code":2,"Message":"A new contact has been added.","Id":79}<br/></div><br/>	Error Results<br/><div>		{"Error":true,"Code":8,"Message":"First or last name is required"}<br/>		{"Error":true,"Code":5,"Message":"The contact you entered already exists for this business."}<br/></div></div><hr/>10. Update a Contact<br/>This is used to update an existing contact.<br/><div><br/>	HTTP POST Parameters<br/><div>		query=update_contact<br/>		cid= (ID of contact)<br/>		first= (first name)<br/>		last= (last name)<br/>		contactemail= (email for contact)<br/>		job= (job title)<br/>		phone= (phone number with only digits)<br/>		extension= (extension with only digits)<br/>		email= (user's email)<br/>		password= (user's password)<br/></div><br/>	Returned JSON Format If Successful<br/><div>		{"Success":true,"Code":1,"Message":"The contact information has been updated."}<br/></div><br/>	Error Results<br/><div>		{"Error":true,"Code":8,"Message":"First or last name is required"}<br/>		{"Error":true,"Code":5,"Message":"The contact you entered already exists for this business."}<br/></div></div><hr/>11. Create an Account<br/>This is used to create an account.<br/><div><br/>	HTTP POST Parameters<br/><div>		query=create_account<br/>		email= (user's email)<br/>		password= (user's password)<br/>		screenname= (user's screen name)<br/></div><br/>	Returned JSON Format If Successful<br/><div>		{"Success":true,"Code":2,"Message":"Your account has been created."}<br/></div><br/>	Error Results<br/><div>		{"Error":true,"Code":8,"Message":"Your screen name must be between 3 and 30 characters."}<br/>		{"Error":true,"Code":8,"Message":"Your email must be between 5 and 60 characters."}<br/>		{"Error":true,"Code":8,"Message":"The email you entered is invalid."}<br/>		{"Error":true,"Code":8,"Message":"Passwords must be at least 6 characters."}<br/>		{"Error":true,"Code":5,"Message":"The screen name or email you entered has already been taken."}<br/></div></div><hr/>12. Write a Review<br/>This is used to create or update a user's review for a specific business.<br/><div><br/>	HTTP POST Parameters<br/><div>		query=write_review<br/>		id= (ID of business)<br/>		rating= (rating from 1 to 5)<br/>		comment= (comment for review)<br/>		email= (user's email)<br/>		password= (user's password)<br/></div><br/>	Returned JSON Format If Successful<br/><div>		{"Success":true,"Code":1,"Message":"Your review has been successfully updated."}<br/>		{"Success":true,"Code":2,"Message":"A new review has been added."}<br/></div><br/>	Error Results<br/><div>		{"Error":true,"Code":8,"Message":"Rating must be between 1 and 5."}<br/></div></div><hr/>Error/Success Format<br/><div>	{"Error":true,"Code":1,"Message":". . ."}<br/>	{"Success":true,"Code":1,"Message":". . ."}	<br/></div><hr/>Error					Code<br/>COULD_NOT_CONNECT:		1<br/>SQL_PREPARE_FAILED:		2<br/>NOT_FOUND:				3<br/>NO_PERMISSION:			4<br/>DUPLICATE_KEY:			5<br/>ACCOUNT_INVALID:		6<br/>INVALID_PARAMETERS:		7<br/>INVALID_ARGUMENTS		8<br/><br/>Success					Code<br/>UPDATE_SUCCESS:			1<br/>INSERT_SUCCESS:			2<br/>DELETE_SUCCESS:			3<br/><hr/>Errors Common to All Queries<br/><div>	{"Error":true,"Code":1,"Message":"A connection to the database could not be established.  Please try again later."}<br/><br/>	{"Error":true,"Code":2,"Message":"There was a problem after connecting to the database.  Please try again."}<br/><br/>	{"Error":true,"Code":7,"Message":"The post parameters you sent are invalid."}<br/></div></div></body></html>